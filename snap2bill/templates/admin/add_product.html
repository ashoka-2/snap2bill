
{% load static %}
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<title>Add Product</title>
<link href="https://cdn.jsdelivr.net/npm/remixicon@4.7.0/fonts/remixicon.css" rel="stylesheet"/>
    <script defer src="{% static 'scripts/setting.js' %}"></script>
    <script defer src="{% static 'scripts/navbar.js' %}"></script>

<link rel="stylesheet" type="text/css" href="{% static 'admin/adminstyle.css' %}">
<link rel="stylesheet" type="text/css" href="{% static 'admin/product.css' %}">
</head>

<body>

    <div class="main-content">
        <div class="admin-left-main-content">

        </div>

        <div class="admin-right-main-content">

            <div class="dashboard-header">
                <div class="header-title">
                    <h1>Add New Product</h1>
                    <span>Fill in the details to create a new inventory item.</span>
                </div>
                <a href="/view_product" class="btn-back">
                    <i class="ri-arrow-left-line"></i> Back to List
                </a>
            </div>

            <div class="form-card">
                <!-- Added id="addProductForm" and novalidate -->
                <form action="/add_product_post" method="post" enctype="multipart/form-data" id="addProductForm" novalidate>
                    {% csrf_token %}

                    <div class="form-grid">

                        <div class="form-group">
                            <label for="product_name">Product Name</label>
                            <input type="text" id="product_name" name="product_name" placeholder="e.g. Smart Watch Series 5" required>
                        </div>

                        <div class="form-group">
                            <label for="category">Category</label>
                            <div class="select-wrapper">
                                <select id="category" name="category" required>
                                    <option value="" disabled selected>Select a Category</option>
                                    {% for i in categorydata %}
                                        <option value="{{ i.id }}">{{ i.category_name }}</option>
                                    {% endfor %}
                                </select>
                            </div>
                        </div>

                        <div class="form-group">
                            <label for="quantity">Stock Quantity</label>
                            <input type="number" id="quantity" name="quantity" placeholder="0" min="1" required>
                        </div>

                        <div class="form-group">
                            <label for="image">Product Image</label>
                            <input type="file" id="image" name="image" class="file-input" accept="image/*" required>
                        </div>

                        <div class="form-group full-width">
                            <label for="description">Description</label>
                            <textarea id="description" name="description" placeholder="Write a detailed description of the product..." rows="4" required></textarea>
                        </div>

                    </div>

                    <div class="form-actions">
                        <button type="submit" class="btn-submit">
                            <i class="ri-save-line"></i> Save Product
                        </button>
                    </div>

                </form>
            </div>

            <!-- Toast Container (Always present in DOM for JS use) -->
            <div id="toast-container">
                {% if messages %}
                    {% for message in messages %}
                    <div class="toast {{ message.tags }}">
                        {% if message.tags == 'success' %}✅{% elif message.tags == 'error' %}⚠️{% endif %}
                        {{ message }}
                    </div>
                    {% endfor %}
                {% endif %}
            </div>

        </div>
    </div>

<script>


    /* --- Form Validation Logic --- */
    const form = document.getElementById('addProductForm');

    form.addEventListener('submit', function(e) {
        let hasError = false;

        // Helper to show error
        const showError = (msg) => {
            showToast(msg, 'error');
            hasError = true;
        };

        // 1. Validate Product Name
        // Requirements: At least 3 chars, allows letters, numbers, spaces
        const name = document.getElementById('product_name').value.trim();
        // Regex allows letters (a-z, A-Z), numbers (0-9) and spaces.
        // It prevents special symbols if strict validation is needed, but "mixture" usually implies alphanumeric.
        const nameRegex = /^[a-zA-Z0-9 ]+$/;

        if (name.length < 3) {
            showError("Product Name must be at least 3 characters long.");
        } else if (!nameRegex.test(name)) {
            showError("Product Name can only contain letters, numbers, and spaces.");
        }

        // 2. Validate Category
        const category = document.getElementById('category').value;
        if (!category) {
            showError("Please select a valid Category.");
        }

        // 3. Validate Quantity
        const quantity = document.getElementById('quantity').value;
        if (!quantity || quantity <= 0) {
            showError("Quantity must be a positive number.");
        }

        // 4. Validate Image
        const image = document.getElementById('image').files.length;
        if (image === 0) {
            showError("Please upload a Product Image.");
        }

        // 5. Validate Description
        // Requirements: At least 5 characters
        const desc = document.getElementById('description').value.trim();
        if (desc.length < 5) {
            showError("Description must be at least 5 characters long.");
        }

        if (hasError) {
            e.preventDefault(); // Stop form submission
        }
    });

    /* Helper: Show Toast Message via JS */
    function showToast(message, type) {
        const container = document.getElementById('toast-container');
        const toast = document.createElement('div');

        // Match your existing CSS classes
        toast.className = `toast ${type}`;

        // Add icon based on type
        const icon = type === 'success' ? '✅' : '⚠️';
        toast.innerHTML = `${icon} ${message}`;

        container.appendChild(toast);

        // Remove after animation (matches CSS animation duration roughly)
        setTimeout(() => {
            toast.remove();
        }, 4000);
    }

    // Auto-remove server-side messages
    setTimeout(()=> {
        const serverToasts = document.querySelectorAll('.toast');
        serverToasts.forEach(t => t.remove());
    }, 6000);

</script>

</body>
</html>