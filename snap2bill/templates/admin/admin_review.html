

{% load static %}
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<title>Admin Reviews</title>

<!-- 1. Favicon -->
    <script src="{% static 'scripts/setting.js' %}"></script>

<!-- 2. Icons & Styles -->
<link href="https://cdn.jsdelivr.net/npm/remixicon@4.7.0/fonts/remixicon.css" rel="stylesheet"/>
<link rel="stylesheet" type="text/css" href="{% static 'admin/adminstyle.css' %}">
<!-- Reusing customerpage.css for shared layout styles if you have it, otherwise styles are inline below -->
{#<link rel="stylesheet" type="text/css" href="{% static 'admin/customerpage.css' %}">#}

<!-- 3. Theme Loader -->

<style>
    /* Ensure Fonts match your system */
    @font-face {
        font-family: magic;
        src: url('/static/fonts/SamsungOne-400.woff2');
    }
    @font-face {
        font-family: bayon;
        src: url('/static/fonts/Bayon.ttf');
    }

    /* Page Specific Styles */
    .rev-header {
        display: flex;
        align-items: center;
        justify-content: space-between;
        margin-bottom: 1.5rem;
        flex-wrap: wrap;
        gap: 1rem;
    }

    .rev-title {
        font-family: bayon, sans-serif;
        font-size: 2rem;
        color: var(--text-main);
        text-transform: uppercase;
        letter-spacing: 1px;
        margin: 0;
    }

    .rev-actions {
        display: flex;
        gap: 0.75rem;
    }

    /* Button Styles */
    .btn {
        display: inline-flex;
        align-items: center;
        gap: 0.5rem;
        padding: 0.7rem 1.2rem;
        border-radius: 99px;
        text-decoration: none;
        font-weight: 700;
        transition: transform 0.2s, box-shadow 0.2s;
        border: 0;
        cursor: pointer;
        font-size: 0.95rem;
        color: var(--surface);
        background: linear-gradient(90deg, var(--primary), var(--accent), var(--primary));
    }

    .btn-ghost {
        background: transparent;
        color: var(--primary);
        border: 1px solid var(--primary);
    }
    .btn-ghost:hover {
        background: var(--bg-body);
        transform: translateY(-2px);
    }

    .rev-filters {
        display: flex;
        gap: 1rem;
        flex-wrap: wrap;
        width: 100%;
        background: var(--surface);
        padding: 1rem;
        border-radius: var(--radius);
        box-shadow: var(--shadow);
        border: 1px solid var(--line);
        margin-bottom: 1.5rem;
        align-items: center;
    }

    .search-input {
        flex: 1;
        min-width: 250px;
        padding: 0.8rem 1rem;
        border-radius: 99px;
        border: 1px solid var(--line);
        background: var(--bg-body);
        color: var(--surface);
        font-family: magic, sans-serif;
        outline: none;
        transition: 0.2s;
    }
    .search-input:focus { border-color: var(--primary); }

    .filter-select {
        padding: 0.8rem 1.5rem;
        border-radius: 99px;
        border: 1px solid var(--line);
        background: var(--bg-body);
        color: var(--text-main);
        font-family: magic, sans-serif;
        cursor: pointer;
        outline: none;
    }

    /* Table Styles matching AdminStyle */
    .table-container {
        background: var(--surface);
        border-radius: var(--radius);
        box-shadow: var(--shadow);
        border: 1px solid var(--line);
        overflow: hidden; /* For rounded corners */
        overflow-x: auto;
    }

    table {
        width: 100%;
        border-collapse: collapse;
        text-align: left;
    }

    thead {
        background: linear-gradient(to right, var(--bg-body), var(--surface));
        border-bottom: 2px solid var(--line);
    }

    th {
        padding: 1.2rem 1.5rem;
        font-weight: 700;
        color: var(--primary);
        text-transform: uppercase;
        font-size: 0.85rem;
        letter-spacing: 0.05em;
        white-space: nowrap;
    }

    /* Icon styling inside table headers */
    th i {
        font-size: 1rem;
        margin-right: 0.4rem;
        vertical-align: text-bottom;
        font-weight: 400;
    }

    td {
        padding: 1.2rem 1.5rem;
        color: var(--text-main);
        border-bottom: 1px solid var(--line);
        font-size: 0.95rem;
    }

    tr:last-child td { border-bottom: none; }

    tbody tr { transition: background 0.2s; }
    tbody tr:hover { background-color: var(--bg-body); }

    /* Star Rating */
    .stars {
        display: flex;
        gap: 2px;
        color: #fbbf24; /* Amber/Gold */
    }
    .stars i.empty {
        color: #e2e8f0; /* Light Gray */
    }
    [data-theme="dark"] .stars i.empty { color: #334155; }

    /* User/Distributor Badges */
    .user-badge {
        display: flex;
        flex-direction: column;
    }
    .user-name { font-weight: 700; color: var(--text-main); }
    .user-role { font-size: 0.8rem; color: var(--text-soft); }

    /* No Data Message */
    #noDataMessage {
        padding: 3rem;
        text-align: center;
        color: var(--text-soft);
        display: none; /* Toggled by JS */
    }
    #noDataMessage i { font-size: 3rem; margin-bottom: 0.5rem; display: block; opacity: 0.5; }

</style>
</head>

<body>

<div class="main-content">
    <!-- Sidebar -->
    <div class="admin-left-main-content">
        <div class="admin-top-left-content"><div class="admin-menu">Snap2Bill <br> Admin Menu</div></div><hr>
        <div class="admin-mid-left-content">
            <div id="navbar-section">
                <a class="nav-links" href="/admin_home"><div class="mid-left-navbars"><i class="ri-home-4-line"></i><span>Home</span></div></a>
                <a class="nav-links" href="/admin_viewcustomer"><div class="mid-left-navbars"><i class="ri-user-3-line"></i><span>View Customers</span></div></a>
                <a class="nav-links" href="/admin_verify"><div class="mid-left-navbars"><i class="ri-shield-check-line"></i><span>Verify Distributors</span></div></a>
                <a class="nav-links" href="/admin_verified"><div class="mid-left-navbars"><i class="ri-award-line"></i><span>View Verified Distributors</span></div></a>
                <a class="nav-links" href="/admin_category"><div class="mid-left-navbars "><i class="ri-layout-grid-line"></i><span>Manage Category</span></div></a>
                <a class="nav-links" href="/admin_review"><div class="mid-left-navbars active"><i class="ri-star-line"></i><span>View Reviews</span></div></a>
                <a class="nav-links" href="/customer_feedbacks"><div class="mid-left-navbars "><i class="ri-feedback-line"></i><span>View Customer Feedback</span></div></a>
                <a class="nav-links" href="/distributor_feedbacks"><div class="mid-left-navbars "><i class="ri-feedback-line"></i><span>View Distributor Feedback</span></div></a>
                <a class="nav-links" href="/view_product"><div class="mid-left-navbars "><i class="ri-multi-image-fill"></i><span>View products</span></div></a>
            </div>
        </div>
        <hr>
        <div class="admin-bottom-left-content">
            <div class="more-section"><span><i class="ri-settings-3-line"></i> Setting</span>
                <div class="setting-dropdown">
                    <a href="/admin_setting" class="setting-menu-dropdown"><i class="ri-tools-line"></i> Settings</a>
                    <a id="themeToggle" type="button" class="setting-menu-dropdown theme-btn"><i id="themeIcon" class="ri-sun-line"></i> Switch theme</a>
                    <a href="/logout" class="setting-menu-dropdown"><i class="ri-logout-box-line"></i> Logout</a>
                </div>
            </div>
        </div>
    </div>

    <!-- Main Content -->
    <div class="admin-right-main-content">

        <!-- Header -->
        <div class="rev-header">
            <div>
                <h1 class="rev-title">Reviews</h1>
                <div style="color:var(--text-soft); font-weight:600; margin-top:0.25rem;">Total Reviews: {{ reviewdata|length }}</div>
            </div>
            <div class="rev-actions">
                <a href="/admin_home" class="btn btn-ghost"><i class="ri-dashboard-line"></i> Dashboard</a>
                  <a class="btn " href="/admin_viewcustomer"><i class="ri-user-3-line"></i> Customers</a>

            </div>
        </div>

        <!-- Filters -->
        <div class="rev-filters">
            <i class="ri-search-2-line" style="color:var(--text-soft);"></i>
            <input type="text" id="searchInput" class="search-input" placeholder="Search by Customer, Distributor or Review content...">

            <select id="ratingFilter" class="filter-select">
                <option value="0">All Ratings</option>
                <option value="5">⭐⭐⭐⭐⭐ (5 Only)</option>
                <option value="4">⭐⭐⭐⭐ & Up</option>
                <option value="3">⭐⭐⭐ & Up</option>
                <option value="2">⭐⭐ & Up</option>
                <option value="1">⭐ & Up</option>
            </select>
        </div>

        <!-- Table -->
        <div class="table-container">
            <table>
                <thead>
                    <tr>
                        <th><i class="ri-hashtag"></i> S.No</th>
                        <th><i class="ri-user-line"></i> Customer</th>
                        <th><i class="ri-store-2-line"></i> Distributor</th>
                        <th><i class="ri-chat-3-line"></i> Review</th>
                        <th><i class="ri-star-fill"></i> Rating</th>
                        <th><i class="ri-calendar-line"></i> Date</th>
                    </tr>
                </thead>
                <tbody id="reviewsTableBody">
                    {% for i in reviewdata %}
                    <tr class="review-row"
                        data-customer="{{ i.USER.name|lower }}"
                        data-distributor="{{ i.DISTRIBUTOR.name|lower }}"
                        data-review="{{ i.reviews|lower }}"
                        data-rating="{{ i.rating }}">

                        <td>{{ forloop.counter }}</td>

                        <td>
                            <div class="user-badge">
                                <span class="user-name">{{ i.USER.name }}</span>
                                <span class="user-role">Customer</span>
                            </div>
                        </td>

                        <td>
                            <div class="user-badge">
                                <span class="user-name">{{ i.DISTRIBUTOR.name }}</span>
                                <span class="user-role">Distributor</span>
                            </div>
                        </td>

                        <td style="max-width: 300px; line-height: 1.5;">
                            {{ i.reviews }}
                        </td>

                        <td>
                            <div class="stars">
                                <!-- Logic to display filled/empty stars based on numeric rating -->
                                {% if i.rating >= 1 %}<i class="ri-star-fill"></i>{% else %}<i class="ri-star-line empty"></i>{% endif %}
                                {% if i.rating >= 2 %}<i class="ri-star-fill"></i>{% else %}<i class="ri-star-line empty"></i>{% endif %}
                                {% if i.rating >= 3 %}<i class="ri-star-fill"></i>{% else %}<i class="ri-star-line empty"></i>{% endif %}
                                {% if i.rating >= 4 %}<i class="ri-star-fill"></i>{% else %}<i class="ri-star-line empty"></i>{% endif %}
                                {% if i.rating >= 5 %}<i class="ri-star-fill"></i>{% else %}<i class="ri-star-line empty"></i>{% endif %}
                            </div>
                        </td>

                        <td style="color:var(--text-soft);">{{ i.review_date }}</td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>

            <!-- No Data Message -->
            <div id="noDataMessage">
                <i class="ri-inbox-2-line"></i>
                <h3>No reviews found</h3>
                <p>Try adjusting your filters.</p>
            </div>
        </div>

    </div>
</div>

<script>
    /* --- Sidebar & Theme Logic --- */
    const moreBtn = document.querySelector(".more-section");
    const dropdown = document.querySelector(".setting-dropdown");
    const themeBtn = document.getElementById('themeToggle');
    const themeIcon = document.getElementById('themeIcon');
    const root = document.documentElement;

    document.body.addEventListener("click", (e) => {
        if (moreBtn.contains(e.target)) dropdown.style.display = dropdown.style.display === "block" ? "none" : "block";
        else if (!dropdown.contains(e.target)) dropdown.style.display = "none";
    });

    const savedTheme = localStorage.getItem('theme') || 'light';
    root.setAttribute('data-theme', savedTheme);
    themeIcon.className = savedTheme === 'dark' ? 'ri-moon-line' : 'ri-sun-line';

    themeBtn.addEventListener('click', () => {
        const next = root.getAttribute('data-theme') === 'dark' ? 'light' : 'dark';
        root.setAttribute('data-theme', next);
        localStorage.setItem('theme', next);
        themeIcon.className = next === 'dark' ? 'ri-moon-line' : 'ri-sun-line';
    });

    /* --- Filtering Logic --- */
    const searchInput = document.getElementById('searchInput');
    const ratingFilter = document.getElementById('ratingFilter');
    const rows = document.querySelectorAll('.review-row');
    const noMsg = document.getElementById('noDataMessage');

    function filterReviews() {
        const query = searchInput.value.toLowerCase();
        const minRating = parseInt(ratingFilter.value);
        let visibleCount = 0;

        rows.forEach(row => {
            const customer = row.dataset.customer;
            const distributor = row.dataset.distributor;
            const review = row.dataset.review;
            const rating = parseInt(row.dataset.rating);

            // Check Search Text
            const matchText = customer.includes(query) || distributor.includes(query) || review.includes(query);
            // Check Rating
            const matchRating = rating >= minRating;

            if (matchText && matchRating) {
                row.style.display = '';
                visibleCount++;
            } else {
                row.style.display = 'none';
            }
        });

        // Show "No Data" if everything is hidden
        noMsg.style.display = (visibleCount === 0) ? 'block' : 'none';
    }

    searchInput.addEventListener('input', filterReviews);
    ratingFilter.addEventListener('change', filterReviews);

</script>

</body>
</html>
{##}
{##}
{#{% load static %}#}
{#<!DOCTYPE html>#}
{#<html lang="en" data-theme="light">#}
{#<head>#}
{#<meta charset="utf-8" />#}
{#<title>Admin Reviews | Snap2Bill</title>#}
{#<link rel="stylesheet" type="text/css" href="{% static 'admin/adminstyle.css' %}">#}
{#    <script src="{% static 'scripts/setting.js' %}"></script>#}
{##}
{#<!-- Remix Icons -->#}
{#<link#}
{#  href="https://cdn.jsdelivr.net/npm/remixicon@4.7.0/fonts/remixicon.css"#}
{#  rel="stylesheet"#}
{#/>#}
{##}
{#<style>#}
{##}
{##}
{##}
{#  .fb-header{ display:flex; align-items:center; justify-content:space-between; gap:1rem; margin-block-end:1.25rem; }#}
{#  .fb-title{ font-size:clamp(1.3rem,2.2vw,1.8rem); font-weight:800; color:var(--text-main); display:flex; align-items:center; gap:.5rem; }#}
{#  .fb-sub{ color:var(--text-soft); font-size:clamp(.9rem,1.2vw,1rem); margin-top:.25em; }#}
{#  .fb-actions{ display:flex; gap:.75rem; flex-wrap:wrap; }#}
{##}
{#  .btn{ display:inline-flex; align-items:center; gap:.4rem; text-decoration:none; border-radius:9999px; font-weight:700; border:0; cursor:pointer; transition:all .3s ease; }#}
{#  .btn i{ font-size:1.2rem; }#}
{#  .btn-primary{ background:linear-gradient(90deg,var(--primary),var(--accent),var(--primary)); color:#fff; padding:.9rem 1.2rem; box-shadow:var(--shadow); }#}
{#  .btn-primary:hover{ transform:translateY(-3px); opacity:.9; }#}
{#  .btn-ghost{#}
{#      background:transparent;#}
{#      color:var(--primary);#}
{#      border:.0625rem solid var(--primary);#}
{#      padding:.85rem 1.1rem;#}
{#  }#}
{#  .btn-ghost:hover{ background:rgba(21,101,192,0.08); transform:translateY(-2px); }#}
{##}
{#  .fb-table-wrap{#}
{#      background:#fff;#}
{#      border:.0625rem solid var(--line);#}
{#      border-radius:calc(var(--radius) + .25rem);#}
{#      box-shadow:var(--shadow);#}
{#      overflow:auto;#}
{#      transition: background .3s ease;#}
{#  }#}
{#  [data-theme="dark"] .fb-table-wrap{ background:transparent; }#}
{##}
{#  table.fb-table{#}
{#      width:100%;#}
{#      border-collapse:separate;#}
{#      border-spacing:0;#}
{#  }#}
{#  .fb-table thead th{#}
{#    position:sticky;#}
{#      top:0;#}
{#      background:linear-gradient(0deg,#f7faff,#ffffff);#}
{#    color:var(--text-main);#}
{#      text-align:left;#}
{#      padding:1rem 1.2rem;#}
{#      font-weight:800;#}
{#    transition:background .3s ease;#}
{#  }#}
{##}
{#</style>#}
{#</head>#}
{##}
{#<body>#}
{##}
{#<div class="main-content">#}
{#  <!-- Sidebar -->#}
{#  <div class="admin-left-main-content">#}
{#    <div class="admin-top-left-content"><div class="admin-menu">Snap2Bill <br> Admin Menu</div></div><hr>#}
{#    <div class="admin-mid-left-content">#}
{#      <div id="navbar-section">#}
{#        <a class="nav-links" href="/admin_home"><div class="mid-left-navbars"><i class="ri-home-4-line"></i><span>Home</span></div></a>#}
{#        <a class="nav-links" href="/admin_viewcustomer"><div class="mid-left-navbars"><i class="ri-user-3-line"></i><span>View Customers</span></div></a>#}
{#        <a class="nav-links" href="/admin_verify"><div class="mid-left-navbars"><i class="ri-shield-check-line"></i><span>Verify Distributors</span></div></a>#}
{#        <a class="nav-links" href="/admin_verified"><div class="mid-left-navbars"><i class="ri-award-line"></i><span>View Verified Distributors</span></div></a>#}
{#          <a class="nav-links" href="/admin_category"><div class="mid-left-navbars "><i class="ri-layout-grid-line"></i><span>Manage Category</span></div></a>#}
{#        <a class="nav-links" href="/admin_review"><div class="mid-left-navbars active"><i class="ri-star-line"></i><span>View Reviews</span></div></a>#}
{#<a class="nav-links" href="/customer_feedbacks"><div class="mid-left-navbars "><i class="ri-feedback-line"></i><span>View Customer Feedback</span></div></a>#}
{#         <a class="nav-links" href="/distributor_feedbacks"><div class="mid-left-navbars "><i class="ri-feedback-line"></i><span>View Distributor Feedback</span></div></a>#}
{#          <a class="nav-links" href="/view_product"><div class="mid-left-navbars "><i class="ri-multi-image-fill"></i><span>View products</span></div></a>#}
{##}
{#      </div>#}
{#    </div>#}
{#    <hr>#}
{#    <div class="admin-bottom-left-content">#}
{#      <div class="more-section"><span><i class="ri-settings-3-line"></i> Setting</span>#}
{#        <div class="setting-dropdown">#}
{#          <a href="admin_setting"><div class="setting-menu-dropdown"><i class="ri-tools-line"></i> Settings</div></a>#}
{#          <a id="themeToggle" type="button" class="setting-menu-dropdown theme-btn">#}
{#            <i id="themeIcon" class="ri-sun-line"></i> Switch theme#}
{#          </a>#}
{#          <a href="/logout"><div class="setting-menu-dropdown"><i class="ri-logout-box-line"></i> Logout</div></a>#}
{#        </div>#}
{#      </div>#}
{#    </div>#}
{#  </div>#}
{##}
{#  <!-- Right Content -->#}
{#  <div class="admin-right-main-content">#}
{##}
{#    <div class="fb-header">#}
{#      <div>#}
{#        <div class="fb-title"><i class="ri-star-line"></i> Reviews</div>#}
{#        <div class="fb-sub">All customer reviews for distributors</div>#}
{#      </div>#}
{#      <div class="fb-actions">#}
{#        <a class="btn btn-ghost" href="/admin_home"><i class="ri-dashboard-line"></i> Dashboard</a>#}
{#        <a class="btn btn-primary" href="/admin_viewcustomer"><i class="ri-user-3-line"></i> Customers</a>#}
{#      </div>#}
{#    </div>#}
{##}
{#    <div class="fb-table-wrap">#}
{#      <table class="fb-table">#}
{#        <thead>#}
{#          <tr>#}
{#            <th><i class="ri-hashtag"></i> S.No</th>#}
{#            <th><i class="ri-user-line"></i> Customer</th>#}
{#            <th><i class="ri-store-2-line"></i> Distributor</th>#}
{#            <th><i class="ri-chat-3-line"></i> Review</th>#}
{#            <th><i class="ri-star-fill"></i> Rating</th>#}
{#            <th><i class="ri-calendar-line"></i> Date</th>#}
{#          </tr>#}
{#        </thead>#}
{#        <tbody>#}
{#          {% for r in reviewdata %}#}
{#          <tr>#}
{#            <td>{{ forloop.counter }}</td>#}
{#            <td>{{ r.USER.name }}</td>#}
{#            <td>{{ r.DISTRIBUTOR.name }}</td>#}
{#            <td>{{ r.reviews }}</td>#}
{#            <td>#}
{#              {% for i in "12345"|slice:":" %}#}
{#                {% if forloop.counter <= r.rating %}#}
{#                  <i class="ri-star-fill" style="color:gold;"></i>#}
{#                {% else %}#}
{#                  <i class="ri-star-line" style="color:gray;"></i>#}
{#                {% endif %}#}
{#              {% endfor %}#}
{#            </td>#}
{#            <td>{{ r.review_date }}</td>#}
{#          </tr>#}
{#          {% empty %}#}
{#          <tr><td colspan="6" style="text-align:center; color:var(--text-soft); padding:2rem;">No reviews yet.</td></tr>#}
{#          {% endfor %}#}
{#        </tbody>#}
{#      </table>#}
{#    </div>#}
{##}
{#  </div>#}
{#</div>#}
{##}
{#<script>#}
{#  // Sidebar dropdown#}
{#  const moreBtn = document.querySelector(".more-section");#}
{#  const dropdown = document.querySelector(".setting-dropdown");#}
{#  document.body.addEventListener("click", e => {#}
{#    if (moreBtn && moreBtn.contains(e.target)) {#}
{#      e.stopPropagation();#}
{#      dropdown.style.display = dropdown.style.display === "block" ? "none" : "block";#}
{#    } else if (dropdown && !dropdown.contains(e.target)) {#}
{#      dropdown.style.display = "none";#}
{#    }#}
{#  });#}
{##}
{#  // Theme toggle with Remix Icons#}
{#  const root = document.documentElement;#}
{#  const themeBtn = document.getElementById('themeToggle');#}
{#  const themeIcon = document.getElementById('themeIcon');#}
{##}
{#  const savedTheme = localStorage.getItem('theme') || 'light';#}
{#  root.setAttribute('data-theme', savedTheme);#}
{#  themeIcon.className = savedTheme === 'dark' ? 'ri-moon-line' : 'ri-sun-line';#}
{##}
{#  themeBtn.addEventListener('click', () => {#}
{#    const current = root.getAttribute('data-theme');#}
{#    const next = current === 'dark' ? 'light' : 'dark';#}
{#    root.setAttribute('data-theme', next);#}
{#    localStorage.setItem('theme', next);#}
{#    themeIcon.className = next === 'dark' ? 'ri-moon-line' : 'ri-sun-line';#}
{#  });#}
{#</script>#}
{#</body>#}
{#</html>#}
